import React, { useState, useEffect } from "react";
import "./CourseForm.css";

const CourseForm = ({ courseData, onSubmit, onCancel }) => {
  const [formData, setFormData] = useState({
    Title: courseData?.Title || "",
    Description: courseData?.Description || "",
    Duration: courseData?.Duration || 60,
    TuitionFee: courseData?.TuitionFee || 0,
    Status: courseData?.Status || "Draft",
  });

  const [errors, setErrors] = useState({});

  useEffect(() => {
    if (courseData) {
      setFormData({
        Title: courseData.Title || "",
        Description: courseData.Description || "",
        Duration: courseData.Duration || 60,
        TuitionFee: parseFloat(courseData.TuitionFee) || 0,
        Status: courseData.Status || "Draft",
      });
    }
  }, [courseData]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [name]:
        name === "Duration"
          ? parseInt(value) || 0
          : name === "TuitionFee"
          ? parseFloat(value) || 0
          : value,
    }));

    // Clear error when user starts typing
    if (errors[name]) {
      setErrors((prev) => ({
        ...prev,
        [name]: "",
      }));
    }
  };

  const validate = () => {
    const newErrors = {};

    if (!formData.Title || formData.Title.trim().length < 3) {
      newErrors.Title = "T√™n kh√≥a h·ªçc ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±";
    }

    if (!formData.Description || formData.Description.trim().length < 10) {
      newErrors.Description = "M√¥ t·∫£ ph·∫£i c√≥ √≠t nh·∫•t 10 k√Ω t·ª±";
    }

    if (!formData.Duration || formData.Duration <= 0) {
      newErrors.Duration = "Th·ªùi l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0 gi·ªù";
    }

    if (!formData.TuitionFee || formData.TuitionFee <= 0) {
      newErrors.TuitionFee = "H·ªçc ph√≠ ph·∫£i l·ªõn h∆°n 0 VND";
    }

    if (!formData.Status) {
      newErrors.Status = "Tr·∫°ng th√°i l√† b·∫Øt bu·ªôc";
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = (e) => {
    e.preventDefault();

    if (validate()) {
      console.log("üìñ CourseForm submitting data:", formData);
      onSubmit(formData);
    }
  };

  const formatCurrency = (value) => {
    return new Intl.NumberFormat("vi-VN", {
      style: "currency",
      currency: "VND",
    }).format(value);
  };

  return (
    <div className="course-form-overlay">
      <div className="course-form-container">
        <div className="form-header">
          <h2>{courseData ? "S·ª≠a Kh√≥a H·ªçc" : "T·∫°o Kh√≥a H·ªçc M·ªõi"}</h2>
          <button className="close-btn" onClick={onCancel}>
            √ó
          </button>
        </div>

        <form onSubmit={handleSubmit} className="course-form">
          <div className="form-group">
            <label htmlFor="Title">
              T√™n kh√≥a h·ªçc <span className="required">*</span>
            </label>
            <input
              type="text"
              id="Title"
              name="Title"
              value={formData.Title}
              onChange={handleChange}
              placeholder="Nh·∫≠p t√™n kh√≥a h·ªçc"
              className={errors.Title ? "error" : ""}
              required
            />
            {errors.Title && (
              <span className="error-message">{errors.Title}</span>
            )}
          </div>

          <div className="form-group">
            <label htmlFor="Description">
              M√¥ t·∫£ <span className="required">*</span>
            </label>
            <textarea
              id="Description"
              name="Description"
              value={formData.Description}
              onChange={handleChange}
              placeholder="Nh·∫≠p m√¥ t·∫£ kh√≥a h·ªçc"
              rows="4"
              className={errors.Description ? "error" : ""}
              required
            />
            {errors.Description && (
              <span className="error-message">{errors.Description}</span>
            )}
          </div>

          <div className="form-row">
            <div className="form-group">
              <label htmlFor="Duration">
                Th·ªùi l∆∞·ª£ng (gi·ªù) <span className="required">*</span>
              </label>
              <input
                type="number"
                id="Duration"
                name="Duration"
                value={formData.Duration}
                onChange={handleChange}
                min="1"
                max="1000"
                className={errors.Duration ? "error" : ""}
                required
              />
              {errors.Duration && (
                <span className="error-message">{errors.Duration}</span>
              )}
            </div>

            <div className="form-group">
              <label htmlFor="TuitionFee">
                H·ªçc ph√≠ (VND) <span className="required">*</span>
              </label>
              <div className="currency-input">
                <input
                  type="number"
                  id="TuitionFee"
                  name="TuitionFee"
                  value={formData.TuitionFee}
                  onChange={handleChange}
                  min="0"
                  step="1000"
                  className={errors.TuitionFee ? "error" : ""}
                  required
                />
                <span className="currency-display">
                  {formData.TuitionFee > 0 &&
                    formatCurrency(formData.TuitionFee)}
                </span>
              </div>
              {errors.TuitionFee && (
                <span className="error-message">{errors.TuitionFee}</span>
              )}
            </div>
          </div>

          <div className="form-group">
            <label htmlFor="Status">
              Tr·∫°ng th√°i <span className="required">*</span>
            </label>
            <select
              id="Status"
              name="Status"
              value={formData.Status}
              onChange={handleChange}
              className={errors.Status ? "error" : ""}
              required
            >
              <option value="Draft">Draft</option>
              <option value="Published">Published</option>
              <option value="Archived">Archived</option>
            </select>
            {errors.Status && (
              <span className="error-message">{errors.Status}</span>
            )}
          </div>

          <div className="form-actions">
            <button type="button" onClick={onCancel} className="btn-cancel">
              H·ªßy
            </button>
            <button type="submit" className="btn-submit">
              {courseData ? "C·∫≠p nh·∫≠t" : "T·∫°o"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CourseForm;






